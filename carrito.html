<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carrito de Compras</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="carrito.css">
</head>

<body>
  <!-- âœ… NAVBAR -->
  <nav class="navbar navbar-expand-lg bg-light shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand fw-bold" href="#">Mi Tienda</a>

      <!-- BotÃ³n a la derecha que abre el menÃº -->
      <button class="btn btn-outline-dark ms-auto" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#menuLateral" aria-controls="menuLateral">
        â˜°
      </button>
    </div>
  </nav>

  <!-- âœ… MENÃš LATERAL -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="menuLateralLabel">MenÃº</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="productos.html">Productos</a></li>
        <li class="nav-item"><a class="nav-link" href="carrito.html">Carrito</a></li>
        <li class="nav-item"><a class="nav-link" href="cuenta.html">Cuenta</a></li>
      </ul>
    </div>
  </div>

  <!-- âœ… CUERPO DEL CARRITO -->
   <script src="Conexion.js"></script>
  <div class="container my-5">
    <h2 class="text-center mb-4">Â¡Tu Carrito de Compras!</h2>

    <table class="table table-bordered" id="tabla-carrito">
      <thead>
        <tr>
          <th scope="col">Producto</th>
          <th scope="col">Precio</th>
          <th scope="col">Cantidad</th>
          <th scope="col">Total</th>
          <th scope="col">Acciones</th>
        </tr>
      </thead>
      <tbody id="carrito-body">
        <!-- Productos cargados dinÃ¡micamente -->
      </tbody>
    </table>

    <div class="total-container">
      <h4>Total: <span id="total">0.00</span> pesos</h4>
    </div>

    <div class="d-flex justify-content-between mt-4">
      <button class="btn btn-danger" id="vaciar-carrito">Vaciar Carrito</button>
      <button class="btn btn-success btn-lg">Proceder al Pago</button>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- âœ… Script principal -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const tbody = document.getElementById("carrito-body");
      const totalElement = document.getElementById("total");
      const vaciarBtn = document.getElementById("vaciar-carrito");

      let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

      // ðŸ”¹ Renderizar los productos
      function mostrarCarrito() {
        tbody.innerHTML = "";
        let total = 0;

        if (carrito.length === 0) {
          tbody.innerHTML = `<tr><td colspan="5" class="text-center">No hay productos en el carrito.</td></tr>`;
          totalElement.textContent = "0.00";
          return;
        }

        carrito.forEach((item, index) => {
          const precioNum = parseFloat(item.precio.replace(/[^0-9.]/g, ""));
          const subtotal = precioNum * item.cantidad;
          total += subtotal;

          const fila = document.createElement("tr");
          fila.innerHTML = `
            <td>
              <img src="${item.imagen}" alt="${item.nombre}" class="img-fluid rounded" style="width:80px;">
              <span class="ms-2">${item.nombre}</span>
            </td>
            <td>$${precioNum.toFixed(2)}</td>
            <td><input type="number" class="form-control cantidad" value="${item.cantidad}" min="1" data-index="${index}"></td>
            <td class="subtotal">$${subtotal.toFixed(2)}</td>
            <td><button class="btn btn-danger btn-sm eliminar" data-index="${index}">Eliminar</button></td>
          `;
          tbody.appendChild(fila);
        });

        totalElement.textContent = total.toFixed(2);
      }

      mostrarCarrito();

      // ðŸ”¹ Actualizar cantidad
      tbody.addEventListener("input", (e) => {
        if (e.target.classList.contains("cantidad")) {
          const index = e.target.dataset.index;
          carrito[index].cantidad = parseInt(e.target.value);
          localStorage.setItem("carrito", JSON.stringify(carrito));
          mostrarCarrito();
        }
      });

      // ðŸ”¹ Eliminar producto
      tbody.addEventListener("click", (e) => {
        if (e.target.classList.contains("eliminar")) {
          const index = e.target.dataset.index;
          carrito.splice(index, 1);
          localStorage.setItem("carrito", JSON.stringify(carrito));
          mostrarCarrito();
        }
      });

      // ðŸ”¹ Vaciar carrito
      vaciarBtn.addEventListener("click", () => {
        if (confirm("Â¿Seguro que deseas vaciar el carrito?")) {
          localStorage.removeItem("carrito");
          carrito = [];
          mostrarCarrito();
        }
      });
    });
  </script>
</body>

</html>
